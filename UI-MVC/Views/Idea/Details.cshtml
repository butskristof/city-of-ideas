@using COI.BL.Domain.User
@using Microsoft.AspNetCore.Identity
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@model COI.BL.Domain.Ideation.Idea

@{
	ViewBag.Title = @Model.Title;
	Layout = "_Layout";
}

<!-- Content -->
<main class="content content--shadow container">
	<!-- Idea -->
	<article class="page__intro mt-3">
		<h1 id="ideaTitle">@Model.Title</h1>

        <p id="ideaFields">
			@foreach (var field in @Model.Fields)
			{
				@field.Content
			}
        </p>
		<div class="options-bar">
			<div class="options-bar__option">
                <span class="options-bar__votes mr-2" id="ideaVoteCount">@Model.GetScore()</span>
				<i class="voter material-icons outline mr-2" data-counter="ideaVoteCount" data-target="Idea" data-targetId="@Model.IdeaId" data-value="1">thumb_up</i>
				<i class="voter material-icons outline" data-counter="ideaVoteCount" data-target="idea" data-targetId="@Model.IdeaId" data-value="-1">thumb_down</i>
			</div>
			<div class="options-bar__option">
				<i class="material-icons outline ml-4">share</i>
			</div>
		</div>
	</article>
	<!-- /Idea -->

	<!-- Comments -->
	<section class="comments mt-5 pt-4">
		<h1 class="comments__title pb-4">
			Reacties
		</h1>
		
        <div id="comments">
        </div>
	</section>
	<!-- /Comments -->
	
	@if (SignInManager.IsSignedIn(User))
	{
        <!-- Editor -->
        <form method="post" class="editor mt-10" id="ideaEditor">
            <h2 clas="mb-2">Schrijf een eigen reactie</h2>

            <div class="editor__text-container">
                <div class="editor__options">
                    <div class="editor__option editor__option--image">
                        <i class="material-icons">add_photo_alternate</i>
                        Foto toevoegen
                    </div>
                    <div class="editor__option editor__option--image">
                        <i class="material-icons">add_location</i>
                        Locatie toevoegen
                    </div>
                </div>

                <textarea
                    name="text"
                    class="editor__text textbox"
                    placeholder="Schrijf een reactie"
                ></textarea>
            </div>

            <div class="editor__images"></div>

            <input
                type="file"
                class="editor__file-upload"
                accept="image/x-png,image/gif,image/jpeg"
            />

            <button type="submit" class="btn editor__submit mt-2">
                Reactie plaatsen
            </button>
        </form>
        <!-- /Editor -->
	}
	else
	{
        <!-- Log in -->
        <section class="editor mt-10">
            <h2>Schrijf een eigen reactie</h2>
            
            <button class="btn" data-toggle="modal" data-target="#LoginModal">Log in</button>
            <button class="btn" data-toggle="modal" data-target="#RegisterModal">Maak een account</button>
        </section>
        <!-- /Log in -->
	}

</main>
<!-- /Content -->

@section Scripts
{
	@* <script type="text/javascript"> *@
 @*        let idea = @Html.Raw(JsonConvert.SerializeObject(Model)); *@
 @*        let userId = "@(SignInManager.IsSignedIn(User) ? UserManager.GetUserId(User) : null)"; *@
	@* </script> *@
	@* <script type="text/javascript" src="@Url.Content("~/dist/idea.entry.js")" defer></script> *@
    @* <script type="text/javascript" src="@Url.Content("~/dist/pages/idea.entry.js")" defer></script> *@
    <script>
        const ideaId = @Model.IdeaId;
        const userId = '@(SignInManager.IsSignedIn(User) ? UserManager.GetUserId(User) : "-1")';
    </script>
    <script type="text/javascript" src="/dist/idea.entry.js" defer></script>
}
